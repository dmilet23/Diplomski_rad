#!/bin/sh

#start=1601376186256
 #stop=1601462586256

#start = 1601462586256
#stop = 1601376186256

# Datum 16.10.2020.
#start = 1602921695000

# 1602921695000  16.10.2020. 
# - (86400000 * 59) [5097600000]
# ------------------------------
# 1597824095000 Datum od prije dva mjeseca

#-----------------------------------------------------------

# Datum 19.10.2020.
# 1603103044000
# - 5097600000
# ------------------
# 1598005444000 Datum od prije 2 mjeseca (59 dana unazad)

#------------------------------------------------------------
# 21.12.2020.
#1603293695000
#------------------------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------------------------
#1607791853000 13.11.2020. 
# 1605222000000 = 13.11.2020. 1.dan preuzimanja podataka
# 3600000 = 1 sat 
# 900000 = 15 min
# 13.11.2020. => 1605222000000
# 86400000 = 1 dan 
# 15.11.2020 = 1605394800000
# 1 vise da bude 0:0:1 sati
# 16.11.2020. = 1605481200000
# 17.11.2020. = 1605567600000
# 18.11.2020. = 1605654000000
# 19.11.2020. = 1605740400000 + 86400000        30.11.2020. = 1606690800000 + 86400000    11.12.2020. = 1607641200000 + 86400000 
# 20.11.2020. = 1605826800000 + 86400000        1.12.2020. = 1606777200000 + 86400000     12.12.2020. = 1607727600000 + 86400000
# 21.11.2020. = 1605913200000 + 86400000        2.12.2020. = 1606863600000 + 86400000     13.12.2020. = 1607814000000 + 86400000
# 22.11.2020. = 1605999600000 + 86400000        3.12.2020. = 1606950000000                14.12.2020. = 1607900400000 + 86400000
# 23.11.2020. = 1606086000000 + 86400000        4.12.2020. = 1607036400000 + 86400000     15.12.2020. = 1607986800000 + 86400000
# 24.11.2020. = 1606172400000 + 86400000        5.12.2020. = 1607122800000 + 86400000     16.12.2020. = 1608073200000 + 86400000
# 25.11.2020. = 1606258800000 + 86400000        6.12.2020. = 1607209200000 + 86400000     17.12.2020. = 1608159600000 + 86400000
# 26.11.2020. = 1606345200000 + 86400000        7.12.2020. = 1607295600000 + 86400000     18.12.2020. = 1608246000000   
# 27.11.2020. = 1606431600000 + 86400000        8.12.2020. = 1607382000000 + 86400000     19.12.2020. = 1608332400000 
# 28.11.2020. = 1606518000000 + 86400000        9.12.2020. = 1607468400000 + 86400000     20.12.2020. = 1608418800000
# 29.11.2020. = 1606604400000 + 86400000        10.12.2020. = 1607554800000 + 86400000    21.12.2020. = 1608505200000 
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
#--------------------------------------------------------------------------------------------------------------------------------------------------------------
# 22.12.2020. = 1608591600000   26.12.2020. = 1608937200000            30.12.2020. = 1609282800000
# 23.12.2020. = 1608678000000   27.12.2020. = 1609023600000            31.12.2020. = 1609369200000
# 24.12.2020. = 1608764400001   28.12.2020. = 1609110000000
# 25.12.2020. = 1608850800000   29.12.2020. = 1609196400000

# 1.1.2021. = 1609455600000   7.1.2021. = 1609974000000     13.1.2021. = 1610492400000      19.1.2021. = 1611010800000    25.1.2021. = 1611529200000                                      
# 2.1.2021. = 1609542000000   8.1.2021. = 1610060400000     14.1.2021. = 1610578800000      20.1.2021. = 1611097200000    26.1.2021. = 1611615600000
# 3.1.2021. = 1609628400000   9.1.2021. = 1610146800000     15.1.2021. = 1610665200000      21.1.2021. = 1611183600000    27.1.2021. = 1611702000000
# 4.1.2021. = 1609714800000   10.1.2021. = 1610233200000    16.1.2021. = 1610751600000      22.1.2021. = 1611270000000    28.1.2021. = 1611788400000
# 5.1.2021. = 1609801200000   11.1.2021. = 1610319600000    17.1.2021. = 1610838000000      23.1.2021. = 1611356400000    29.1.2021. = 1611874800000
# 6.1.2021. = 1609887600000   12.1.2021. = 1610406000000    18.1.2021. = 1610924400000      24.1.2021. = 1611442800000    30.1.2021. = 1611961200000

# 31.1.2021. = 1612047600000  6.2.2021. = 1612566000000   12.2.2021. = 1613084400000    18.2.2021. = 1613602800000    24.2.2021. = 1614121200000
# 1.2.2021. = 1612134000000   7.2.2021. = 1612652400000   13.2.2021. = 1613170800000    19.2.2021. = 1613689200000    25.2.2021. = 1614207600000
# 2.2.2021. = 1612220400000   8.2.2021. = 1612738800000   14.2.2021. = 1613257200000    20.2.2021. = 1613775600000    26.2.2021. = 1614294000000
# 3.2.2021. = 1612306800000   9.2.2021. = 1612825200000   15.2.2021. = 1613343600000    21.2.2021. = 1613862000000    27.2.2021. = 1614380400000
# 4.2.2021. = 1612393200000   10.2.2021. = 1612911600000  16.2.2021. = 1613430000000    22.2.2021. = 1613948400000    28.2.2021. = 1614466800000
# 5.2.2021. = 1612479600000   11.2.2021. = 1612998000000  17.2.2021. = 1613516400000    23.2.2021. = 1614034800000   

# 1.3.2021. = 1614556800000
# 2.3.2021. = 1614639600000
# 3.3.2021. = 1614726000000
# 4.3.2021. = 1614812400001
# 5.3.2021. = 1614898800001
# 6.3.2021. = 
# 7.3.2021. = 1615071600000
# 8.3.2021. = 1615158000001
# 9.3.2021. = 1615244400001
# 10.3.2021. = 1615330800000
# 11.3.2021. = 1615417200000
# 12.3.2021. = 1615503600000
# 13.3.2021. = 1615590000000
# 14.3.2021. = 1615676400000
# 15.3.2021. = 1615762800000
# 16.3.2021. = 1615849200001
# 17.3.2021. = 1615935600000
# 18.3.2021. = 1616022000000
# 19.3.2021. = 1616108400000
# 20.3.2021. = 1616194800000
# 21.3.2021. = 1616281200000
# 22.3.2021. = 1616367600000
# 23.3.2021. = 1616454000000
# 24.3.2021. = 1616540400000
# 25.3.2021. = 1616626800000
# 26.3.2021. = 1616713200000
# 27.3.2021. = 1616799600001
#---------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------------------
start=1616799600001
# razmak po 15 min
diff=900000
# razmak po 7 min i 30 s
#diff=450000
#diff=225000
# razmak po 3 min i 45 s
#diff=225000

for i in $(seq 1 96);
do
echo "aaaa"

#num1="$(($num1+$num2))"

  stop="$(($start+$diff))"  
  #date --date='@1601376186'
  echo $start
  echo $stop
  #echo  "http://10.53.0.62/api/reporting/generate/csv?jobParams=(conflictedTypesFields:!(),fields:!(timestamp,fingerprint,channel_name),indexPatternId:%2702214ed0-7e0e-11e9-b373-1dd44c6c5d2a%27,metaFields:!(_source,_id,_type,_index,_score),searchRequest:(body:(_source:(excludes:!(),includes:!(timestamp,fingerprint,channel_name)),docvalue_fields:!(),query:(bool:(filter:!(),must:!((match_all:()),(bool:(minimum_should_match:1,should:!((match_phrase:(channel_name:HRT3)),(match_phrase:(channel_name:%27HRT%203%27)),(match_phrase:(channel_name:%27HRT3%20SD%27)),(match_phrase:(channel_name:%27HRT3%20HD%27)),(match_phrase:(channel_name:HRT4)),(match_phrase:(channel_name:%27HRT%204%27)),(match_phrase:(channel_name:%27HRT4%20SD%27)),(match_phrase:(channel_name:%27HRT4%20HD%27))))),(range:(timestamp:(format:epoch_millis,gte:$start,lte:$stop)))),must_not:!(),should:!())),script_fields:(),sort:!((timestamp:(order:desc,unmapped_type:boolean))),stored_fields:!(timestamp,fingerprint,channel_name),version:!t),index:%27viewership-prod*%27),title:dino100,type:search)"\

  curl -o temp "http://10.53.0.62/api/reporting/generate/csv?jobParams=(conflictedTypesFields:!(),fields:!(timestamp,fingerprint,channel_name),indexPatternId:%2702214ed0-7e0e-11e9-b373-1dd44c6c5d2a%27,metaFields:!(_source,_id,_type,_index,_score),searchRequest:(body:(_source:(excludes:!(),includes:!(timestamp,fingerprint,channel_name)),docvalue_fields:!(),query:(bool:(filter:!(),must:!((match_all:()),(bool:(minimum_should_match:1,should:!((match_phrase:(channel_name:HRT3)),(match_phrase:(channel_name:%27HRT%203%27)),(match_phrase:(channel_name:%27HRT3%20SD%27)),(match_phrase:(channel_name:%27HRT3%20HD%27)),(match_phrase:(channel_name:HRT4)),(match_phrase:(channel_name:%27HRT%204%27)),(match_phrase:(channel_name:%27HRT4%20SD%27)),(match_phrase:(channel_name:%27HRT4%20HD%27))))),(range:(timestamp:(format:epoch_millis,gte:$start,lte:$stop)))),must_not:!(),should:!())),script_fields:(),sort:!((timestamp:(order:desc,unmapped_type:boolean))),stored_fields:!(timestamp,fingerprint,channel_name),version:!t),index:%27viewership-prod*%27),title:dino100,type:search)"\
    -X 'POST' \
    -H 'Connection: keep-alive' \
    -H 'Content-Length: 0' \
    -H 'Authorization: Basic a2FybGFqZXpha29uOmthcmxhamV6YWtvbg==' \
    -H 'kbn-version: 6.5.4' \
    -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36' \
    -H 'Content-Type: application/json' \
    -H 'Accept: */*' \
    -H 'Origin: http://10.53.0.62' \
    -H 'Referer: http://10.53.0.62/app/kibana' \
    -H 'Accept-Language: en-US,en;q=0.9' \
    --compressed \
    --insecure


  #cat temp

  sleep 50


  DOWPAT=$(cat temp|grep -i path|awk -F '"' '{print $4}')

  echo $DOWPAT


  
  curl -o data_$i.csv "http://10.53.0.62$DOWPAT"   -H 'Connection: keep-alive'   -H 'Authorization: Basic a2FybGFqZXpha29uOmthcmxhamV6YWtvbg=='   -H 'Upgrade-Insecure-Requests: 1'   -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36'   -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'   -H 'Accept-Language: en-US,en;q=0.9'   --compressed   --insecure


  cat data_$i.csv
start=$stop


done